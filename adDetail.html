<!DOCTYPE html>
<html lang="en">

<head>
    <title id="pageTitle"></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="icon" type="image/png" href="images/favicon.png" />
    <style>
        /* Center the loader */
        #loader {
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 1;
            width: 150px;
            height: 150px;
            margin: -75px 0 0 -75px;
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Add animation to "page content" */
        .animate-bottom {
            position: relative;
            -webkit-animation-name: animatebottom;
            -webkit-animation-duration: 1s;
            animation-name: animatebottom;
            animation-duration: 1s
        }

        @-webkit-keyframes animatebottom {
            from {
                bottom: -100px;
                opacity: 0
            }

            to {
                bottom: 0px;
                opacity: 1
            }
        }

        @keyframes animatebottom {
            from {
                bottom: -100px;
                opacity: 0
            }

            to {
                bottom: 0;
                opacity: 1
            }
        }

        #myDiv {
            display: none;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="loader" style="display: none;"></div>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">SALES24.com</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="index.html">Home</a></li>
                <li><a href="#">DEALS</a></li>
                <li><a href="#">ABOUT</a></li>
                <li><a href="#">CONTACT</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="navbar-text" id="lastLogin"></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userActions" data-toggle="dropdown" href="#"
                        role="button" aria-haspopup="true" aria-expanded="false">
                        Hi,User
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="profile.html">Profile</a></li>
                        <li><a href="postAd.html">Post AD</a></li>
                        <li><a href="adsPosted.html">AD's Posted</a></li>
                        <li><a href="javascript:void(0)" onclick="logout()">Logout</a></li>
                        <li><a href="javascript:void(0)" onclick="logoutAll()">Logout Of All Devices</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">



        <form class="form-horizontal" action="javascript:void(0)" id="adDetail">
            <fieldset id="formField" disabled="disabled">
                <div>
                    <img src="test.html" class="center" style="display:block;
                  margin:auto;" id="productImage">
                </div>
                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="productName">Product Name</label>
                    <div class="col-md-4">
                        <input id="productName" name="productName" type="text" placeholder="productName"
                            class="form-control input-md" required="">

                    </div>
                </div>

                <!-- Textarea -->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="description">Product Description</label>
                    <div class="col-md-4">
                        <textarea class="form-control" id="productDescription" name="description"
                            placeholder="Product Description" required></textarea>
                    </div>
                </div>

                <!-- Select Basic -->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="selectbasic">Product Category</label>
                    <div class="col-md-4">
                        <select id="productCategory" name="productCategory" class="form-control">
                            <option value="Electronics" selected>Electronics</option>
                            <option value="Fashion">Fashion</option>
                            <option value="Home Appliances">Home Appliances</option>
                            <option value="Two Wheeler">Two Wheeler</option>
                            <option value="Four Wheeler">Four Wheeler</option>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="productBrand">Product Brand</label>
                    <div class="col-md-4">
                        <input id="productBrand" name="productBrand" type="text" placeholder="productBrand"
                            class="form-control input-md" required="">

                    </div>
                </div>

                <!-- Text input-->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="productName">Product Price</label>
                    <div class="col-md-4">
                        <input id="productPrice" name="productPrice" type="number" minlength="2"
                            placeholder="productPrice" class="form-control input-md" required="" pattern="[0-9].{1,}">
                    </div>
                </div>

                <!-- Select Basic -->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="selectbasic">Location</label>
                    <div class="col-md-4">
                        <select id="productLocation" name="productLocation" class="form-control">
                            <option> Choose...</option>
                            <option>Mumbai</option>
                            <option selected="">Bangalore</option>
                            <option>Pune</option>
                            <option>Hyderabad</option>
                            <option>Kolkata</option>
                        </select>
                    </div>
                </div>

                <!-- Select Basic -->
                <div class="form-group">
                    <label class="col-md-4 control-label" for="selectbasic">AD Status</label>
                    <div class="col-md-4">
                        <select id="adStatus" name="AD Status" class="form-control">
                            <option> Choose...</option>
                            <option>Closed</option>
                            <option selected="">Active</option>
                        </select>
                    </div>
                </div>


            </fieldset>
            <div class="form-group">
                <label class="col-md-4 control-label" for="button1id"></label>
                <div class="col-md-8">
                    <button id="editButton" name="editButton" class="btn btn-primary">Edit</button>
                    <button id="submitButton" name="submitButton" class="btn btn-success"
                        style="display: none;">Submit</button>
                    <button id="closeButton" name="closeButton" class="btn btn-primary">Close</button>
                </div>
            </div>
        </form>
</body>
<script>

    document.getElementById('editButton').addEventListener('click', (e) => {
        e.preventDefault()
        document.getElementById('editButton').style.display = "none"
        document.getElementById('closeButton').style.display = "none"
        document.getElementById('formField').disabled = false
        document.getElementById('submitButton').style.display = "block"
    })

    document.getElementById('submitButton').addEventListener('click', (e) => {
        e.preventDefault()
        window.location.reload(true);
    })

    document.getElementById('closeButton').addEventListener('click', (e) => {
        e.preventDefault()
        window.location = 'adsPosted.html'
    })

    function readCookie(name) {
        var i, c, ca, nameEQ = name + "=";
        ca = document.cookie.split(';');
        for (i = 0; i < ca.length; i++) {
            c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1, c.length);
            }
            if (c.indexOf(nameEQ) == 0) {
                return c.substring(nameEQ.length, c.length);
            }
        }
        return 'None';
    }
    var delete_cookie = function (name) {
        document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    };
    if (readCookie("_sales24JWT") == 'None') {
        window.location = 'login.html';
    }

    var user_data = JSON.parse(readCookie("_sales24JWT"))
    document.getElementById("userActions").innerHTML = "Hi, " + user_data.username,
        document.getElementById("lastLogin").innerHTML = "Last Login: " + user_data.lastLogin

    function logout() {
        var logout_confirm = confirm("Do you wish to logout?")
        if (logout_confirm) {
            const url = "https://8xmv9zllk6.execute-api.us-east-1.amazonaws.com/DEV/me/logout"
            document.getElementById("loader").style.display = "block";
            var logout_operation = async () => await fetch(url, {
                Host: "8xmv9zllk6.execute-api.us-east-1.amazonaws.com",
                method: 'GET',
                headers: {
                    'Content-Type': 'application/text',
                    'Authorization': user_data.Token
                }
            }).then((res) => {
                return res.text().then((data) => {
                    alert("You Have successfully Logged out of current session.")
                    delete_cookie("_sales24JWT")
                    window.location = 'index1.html';
                })
            }).catch((err) => {
                alert("Something went wrong. Please login Again")
                delete_cookie("_sales24JWT")
                window.location = 'login.html';
            })
            logout_operation()
        }
    }


    function logoutAll() {
        var logoutAll_confirm = confirm("Do you wish to logout from All Devices?")
        if (logoutAll_confirm) {
            const url = "https://8xmv9zllk6.execute-api.us-east-1.amazonaws.com/DEV/me/logoutall"
            document.getElementById("loader").style.display = "block";
            var logoutAll_operation = async () => await fetch(url, {
                Host: "8xmv9zllk6.execute-api.us-east-1.amazonaws.com",
                method: 'GET',
                headers: {
                    'Content-Type': 'application/text',
                    'Authorization': user_data.Token
                }
            }).then((res) => {
                return res.text().then((data) => {
                    alert("You Have successfully Logged out of all devices.")
                    delete_cookie("_sales24JWT")
                    window.location = 'index1.html';
                })
            }).catch((err) => {
                alert("Something went wrong. Please login Again")
                delete_cookie("_sales24JWT")
                window.location = 'login.html';
            })
            logoutAll_operation()
        }
    }

    var adDetail = async function (AD_KEY) {
        document.getElementById("adDetail").style.display = "none"
        document.getElementById("loader").style.display = "block";
        var adDetail_url = "https://8xmv9zllk6.execute-api.us-east-1.amazonaws.com/DEV/me/addetail"
        await fetch(adDetail_url, {
            Host: "8xmv9zllk6.execute-api.us-east-1.amazonaws.com",
            method: 'POST',
            'body': JSON.stringify({ AD_KEY }),
            headers: {
                'Content-Type': 'application/text',
                'Authorization': user_data.Token
            }
        }).then((res) => {
            return res.text().then((data) => {
                if (res.statusCode == 400) {
                    document.getElementById("adDetail").style.display = "block"
                    document.getElementById("loader").style.display = "none";
                    alert("Sorry the Ad you are searching is not posted by you.")
                    window.location = "index.html"
                }

                if (res.statusCode == 500) {
                    document.getElementById("adDetail").style.display = "none"
                    document.getElementById("loader").style.display = "none";
                    alert("Something went wrong please try again.")
                    return;
                }
                data = JSON.parse(data)
                document.getElementById('productImage').src = data.S3_LOCATION
                document.getElementById('pageTitle').innerHTML = data.PRODUCT_NAME
                document.getElementById('productName').value = data.PRODUCT_NAME
                document.getElementById('productDescription').value = data.PRODUCT_DESCRIPTION
                document.getElementById('productBrand').value = data.PRODUCT_BRAND
                document.getElementById('productCategory').value = data.PRODUCT_CATEGORY
                document.getElementById('productPrice').value = data.PRODUCT_PRICE
                document.getElementById('productLocation').value = data.PRODUCT_LOCATION
                document.getElementById('adStatus').value = data.PRODUCT_STATUS
                document.getElementById("adDetail").style.display = "block"
                document.getElementById("loader").style.display = "none";
            }).catch((err) => {
                document.getElementById("adDetail").style.display = "block"
                document.getElementById("loader").style.display = "none";
                alert("Something went wrong. Please try again.")
            })
        })
            .catch((err) => {
                alert("Something went wrong. Please try again.")
                window.location = "index1.html"
            })
    }

    const params = new URLSearchParams(document.location.search);
    const adId = params.get("AD_ID");
    adDetail(adId)
    var ads_posted = async () => {
var body="";
if(sessionStorage.getItem('lastSearchedKey')){
  body=JSON.stringify({"lastScannedIndex":JSON.parse(sessionStorage.getItem('lastSearchedKey'))})
  sessionStorage.removeItem("lastSearchedKey");
}
var url = "https://8xmv9zllk6.execute-api.us-east-1.amazonaws.com/DEV/me/recentlypostedads"
document.getElementById("mainHead").style.display = "none"
document.getElementById("loader").style.display = "block";
await fetch(url, {
    Host: "8xmv9zllk6.execute-api.us-east-1.amazonaws.com",
    method: 'POST', // or 'PUT',
    body
}).then((res) => {
    if (res.status == 400) {
        document.getElementById("loader").style.display = "block";
        return res.text().then((data) => {
            alert("Something went wrong. Please try again.")
            document.getElementById("loader").style.display = "none";
            document.getElementById("mainhead").style.display = "block"
        });
    }
    return res.text().then((data) => {
        document.getElementById("mainHead").style.display = "none";
        document.getElementById("loader").style.display = "block"
        console.log(data)
        var total_data = JSON.parse(data)
        console.log(total_data)
        if(total_data.LAST_KEY){
          sessionStorage.setItem('lastSearchedKey',JSON.stringify(total_data.LAST_KEY))
        }
        total_data = total_data.ITEMS
        if (total_data.length == 0) {
            document.getElementById("mainHead").style.display = "block";
            document.getElementById("loader").style.display = "none"
            document.getElementById("noAds").style.display = "block"
            return;
        }
        for (var i = 0; i < total_data.length; i++) {
            generateCard(total_data[i].AD_KEY, total_data[i].PRODUCT_NAME, total_data[i].PRODUCT_DESCRIPTION, total_data[i].PRODUCT_PRICE, total_data[i].PRODUCT_LOCATION, total_data[i].S3_LOCATION)
            console.log(i)
            if (i == total_data.length - 1) {
                document.getElementById("mainHead").style.display = "block";
                document.getElementById("loader").style.display = "none"
            }
            if (i == 3) {
                document.getElementById("mainHead").style.display = "block";
                document.getElementById("loader").style.display = "none"
                break;
            }
        }
    })
})
    .catch((err) => {
        alert("Something Went Wrong. Please login again.")
        document.getElementById("loader").style.display = "none";
        document.getElementById("mainHead").style.display = "block"
    })

}
</script>

</html>